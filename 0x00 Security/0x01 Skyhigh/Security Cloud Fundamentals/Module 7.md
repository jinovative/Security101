### 📚 모듈 7: Skyhigh Security Cloud와 클라우드 네이티브 애플리케이션 보호 플랫폼 (CNAPP)

이 모듈에서는 CNAPP의 개념, Skyhigh Security Cloud의 CNAPP 솔루션, 컨테이너 보안, 나노세그멘테이션 등 클라우드 네이티브 환경의 보안 과제와 해결책을 학습합니다.

---

#### **강의 7.1: CNAPP 소개**

- **CNAPP란 무엇인가?**
    - CNAPP는 클라우드 기반 애플리케이션의 개발 및 배포를 더욱 안전하게 만드는 것을 목표로 하는 통합 보안 플랫폼입니다.
        
    - 조직이 온프레미스에서 퍼블릭 클라우드 IaaS(Infrastructure as a Service)로 워크로드를 이전함에 따라 IaaS 워크로드의 전체 수가 빠르게 증가하고 있습니다. 대다수 기업은 현재 컨테이너 기반 애플리케이션을 시험적으로 사용하거나 이미 사용 중이며, 서버리스 PaaS(Platform as a Service)도 실험하고 있습니다.
        
    - Skyhigh Security는 CNAPP를 통해 이러한 문제를 해결합니다.
        
    - CNAPP의 세 가지 기본 기능 영역은 **CSPM(Cloud Security Posture Management, 클라우드 보안 형상 관리)**, **CWPP(Cloud Workload Protection Platform, 클라우드 워크로드 보호 플랫폼)**, 그리고 클라우드에서 사용되는 **애플리케이션 및 데이터(Apps and Data)** 입니다. (참고: Skyhigh Security는 더 이상 CWPP 솔루션을 지원하지 않습니다.)
        
    - Skyhigh Security Cloud 콘솔 내에서 관리자는 모든 유형의 계정, CSP(Cloud Service Provider, 클라우드 서비스 제공업체), 컨테이너, VM(Virtual Machine, 가상 머신), 하이브리드 환경 전반에 걸쳐 비즈니스 위험 관점에서 통합된 정책과 워크플로우를 가질 수 있습니다.
        
- **CNAPP가 필요한 이유**
    - 클라우드 인프라 구성 오류로 인한 위험이 워크로드 자체의 손상보다 더 큽니다.
        
    - 클라우드 네이티브 애플리케이션의 경우, 워크로드 보안은 개발 단계에서부터 사전에 시작되어야 합니다.
        
    - 컨테이너 및 서버리스 워크로드는 개발 단계에서 취약점 및 구성 오류에 대해 스캔되지만, 실제 배포 시에는 워크로드 내부에 거의 또는 전혀 런타임 보호 없이 배포되고 대신 외부 네트워크 장비 및 이벤트 모니터링에 의존하여 위협을 탐지하는 경우가 많습니다.
        
    - CWPP와 CSPM 기능을 결합하면 시너지 효과가 있으며, 이 조합은 개발 단계에서 워크로드와 구성을 스캔하고 런타임에 워크로드와 구성을 보호하는 새로운 CNAPP 범주를 만듭니다.
        
- **Skyhigh CNAPP 아키텍처 개요**
    - **제어 평면 (Control Plane)**: IAM(Identity and Access Management, ID 및 접근 관리) 구성, 네트워크 구성, 스토리지 구성, PaaS 구성 등을 포함하며, 클라우드 네이티브 보안 서비스(ADC, LB, WAF, DoS, FW 등)와 CSPM을 통해 관리됩니다.
        
    - **데이터 평면 (Data Plane)**: 실제 워크로드가 실행되는 환경으로, CWPP를 통해 보호됩니다. (다시 한번, Skyhigh는 CWPP를 더 이상 지원하지 않음에 유의하세요.)
        
    - **에이전트 (Agent)**: 경량이며, Facebook의 성숙한 OSQuery를 기반으로 사용자 공간에서 작동합니다. 모듈식이며 자동 업데이트가 용이하고, 데이터센터/클라우드에 최적화되어 있으며, 크로스 플랫폼을 지원합니다.
        
    - **PoP (Point of Presence, 접속 지점) 아키텍처**: 에이전트는 DXL(Data Exchange Layer)을 통해 PoP로 데이터를 전송하고, PoP는 Skyhigh Security Cloud로 데이터를 전송하는 유일한 연결 지점입니다. 각 지역에는 다른 PoP 설치가 있을 수 있습니다. CI/CD(Continuous Integration/Continuous Deployment, 지속적 통합/지속적 배포) 워크플로우, DLP 스토리지 스캔 등을 지원합니다.
        

---

#### **강의 7.2: CNAPP의 주요 기능**

- **리소스 위험 우선순위 지정 (Resource Risk Prioritization)**
    - CNAPP는 각 리소스에 대해 위험 유형(높음/중간/낮음)이라는 새로운 메트릭을 추가합니다.
        
    - 각 리소스에 대해 위험 수준이 정의되므로 관리자는 위험의 우선순위를 더 잘 정할 수 있습니다. 이전에는 규정 준수 플래그(이진)만 표시되어 위험 처리의 중요성을 이해하는 데 도움이 되지 않았습니다.
        
    - 관리자는 이제 섀도우 IT에 사용할 수 있는 것과 유사한 접근 방식을 취하여 위험 점수 1-9를 적용하여 위험 관리 우선순위를 정할 수 있습니다.
        
    - **개별 리소스 위험 세부 정보**: 하나의 S3 버킷에 구성, 위협 및 이상 징후, DLP, 외부 트래픽 위험 등 여러 범주에 걸친 위험이 연관될 수 있습니다.
        
- **애플리케이션 위험 우선순위 지정 (Application Risk Prioritization)**
    - AWS 태깅 및 Skyhigh Security Cloud 독점 방법(독점 AI 전략 포함)을 포함한 상관 관계 기술을 사용하여 Skyhigh Security Cloud는 리소스를 애플리케이션 또는 마이크로서비스로 그룹화할 수 있습니다.
        
    - 대부분의 보안팀에게 리소스를 애플리케이션에 연결하는 것은 매우 어렵습니다. CNAPP는 이러한 상관 관계를 통해 이 애플리케이션과 관련된 리소스 수준의 위험을 이해함으로써 관리자가 애플리케이션 위험 점수를 결정하는 데 도움을 줄 수 있습니다.
        
    - **애플리케이션 요약 보기**: 특정 애플리케이션과 관련된 위험을 보여줍니다. 예를 들어, 헬스케어 애플리케이션을 지원하는 51개의 리소스가 있고, 이 앱과 관련된 여러 보안 인시던트(구성 감사, DLP, 악성코드, 취약점 등)가 있을 수 있습니다. CNAPP는 이 중 어떤 위험(예: 구성 감사 관련 위험)을 우선적으로 탐색해야 하는지 보여줍니다.
        
- **CSPM (Cloud Security Posture Management) 조치 및 개선**
    - 관리자는 어떤 구성 감사 인시던트가 트리거되었는지, 그리고 그 심각도를 자세히 살펴볼 수 있습니다. 예를 들어, MFA(Multi-Factor Authentication)가 없거나 워크로드 에이전트가 설치되지 않았거나 일부 컨테이너가 루트로 실행 중인 경우 등이 있습니다.
        
    - Skyhigh Security는 개선 조치를 제안합니다. 관리자는 CNAPP 워크로드 에이전트를 배포하거나 다른 권장 사항을 검토하여 구성 문제를 해결할 수 있습니다. 워크로드 에이전트 배포 작업은 에이전트 링크 또는 Puppet 스크립트를 사용하여 수행할 수 있습니다. Puppet은 구성 관리 프로세스를 중앙 집중화하고 자동화하는 시스템 관리 도구입니다.
        

---

#### **강의 7.3: 컨테이너 보안 (Container Security)**

- **컨테이너란 무엇인가? 컨테이너 보안의 과제**
    - 컨테이너는 플랫폼이나 컴퓨팅 환경에 관계없이 실행되는 데 필요한 모든 구성 요소와 종속성을 포함하는 소프트웨어 코드 단위입니다. 개발자들은 유연성, 확장성, 이식성, 개발 속도 때문에 컨테이너를 사용하여 최신 애플리케이션과 서비스를 만듭니다.
        
    - **보안 과제**:
        - **생태계**: 컨테이너는 독립적으로 배포되지 않고 퍼블릭/프라이빗 클라우드, 기존 워크로드와 통합된 하이브리드 클라우드 등 다양한 아키텍처의 일부로 배포됩니다.
            
        - **일시성 (Ephemeral)**: 컨테이너 수명 주기는 종종 초 단위로 측정되지만 변동성이 커서 일반화하기 어렵습니다. 보안팀은 몇 초만 온라인 상태일 수 있는 컨테이너와 몇 주 동안 온라인 상태일 수 있는 컨테이너의 보안과 무결성을 모두 고려해야 합니다.
            
        - **DevOps 파이프라인**: 컨테이너 워크로드는 개발자 주도인 경향이 있으며, 보안의 과제는 개발자가 "안전하게 태어난(BornSecure)" 애플리케이션을 생산하도록 지원하는 것입니다.
            
- **컨테이너 오케스트레이션 (Container Orchestration)** (예: 쿠버네티스 - K8S)
    - 컨테이너 오케스트레이션은 여러 클러스터 내에서 마이크로서비스 기반 애플리케이션을 위한 개별 컨테이너 작업을 자동으로 관리하거나 예약하는 프로세스입니다. 컨테이너의 확장성과 가용성을 자동으로 처리합니다. 일반적인 방법은 쿠버네티스(K8S)를 사용하는 것입니다.
        
- **Skyhigh Security Cloud 컨테이너 보안 기능**
    - Skyhigh Security Cloud for Containers는 다양한 IaaS 플랫폼의 컨테이너 기반 워크로드에 대한 추가 보안을 제공하여 데이터 보안, 위협 방지, 거버넌스 및 규정 준수 기능을 확장합니다.
        
    - **CSPM (Cloud Security Posture Management)**: 쿠버네티스와 같은 컨테이너 인프라 및 오케스트레이션 시스템에 대한 보안 구성 감사를 제공하여 환경 구성이 위험의 원인이 되지 않도록 합니다. 지원 플랫폼에는 AWS (ECS, EKS, Fargate, Docker), GKE, AKS 등이 포함됩니다.
        
    - **CVS (Container Vulnerability Scan, 컨테이너 취약점 스캔)**: 컨테이너 구성 요소의 취약성을 평가합니다. 빌드 시 및 그 이후 주기적으로 컨테이너에 포함된 코드를 평가하여 알려진 위험을 노출하거나 완화하여 악의적인 행위자가 컨테이너 워크로드를 유출할 기회를 줄입니다. Amazon ECR(Elastic Container Registry) 등을 지원합니다.
        
    - **쉬프트 레프트 (Shift Left)**: DevOps IaC(Infrastructure as Code, 코드형 인프라) 템플릿을 스캔하여 배포 전에 컨테이너 인프라 구성을 검토합니다.
        
    - **런타임 위협 탐지 (Runtime Threat Detection)**: 런타임에 위협을 식별하여 환경의 모든 문제를 찾습니다. 여기에는 검색, 화이트리스팅, 익스플로잇 방지, 세분화와 같은 기능이 포함됩니다. (Skyhigh Security Cloud NanoSec 제품의 제한된 베타 버전으로 지원 )
        
- **Skyhigh Security Cloud 컨테이너 보안의 3대 핵심 요소**
    - **취약점 평가 (Vulnerability Assessment)**: 빌드 시 컨테이너에 포함된 코드를 평가합니다.
        
    - **클라우드 보안 형상 관리 (Cloud Security Posture Management)**: 클라우드 구성의 지속적인 확인을 통해 잘못된 구성이나 변경 사항을 탐지하고 완화합니다.
        
    - **나노세그멘테이션 (Nano-segmentation)**: 컨테이너 프로세스 간 네트워크 통신 동작을 검색하고 모니터링하여 애플리케이션, 컨테이너, 프로세스 및 해당 동작의 나노 단위에 대한 상황별 가시성을 확보합니다.
        
- **컨테이너에 대한 구성 감사 및 취약점 보고서**
    - 컨테이너 보안 요구 사항에 따라 정책 템플릿을 선택하고 정책에 적용한 후 구성 감사를 수행할 수 있습니다. 정책 범주 아래에 컨테이너 보안 섹션이 표시되어 컨테이너의 취약점을 파악하는 데 도움이 됩니다.
        
    - 취약점 보고서는 컨테이너 이미지 및 실행 중이거나 실행 중이 아닌 VM(Virtual Machine)에 저장된 모든 CVE(Common Vulnerabilities and Exposures)를 나열합니다.
        
- **컨테이너 이미지 제어 정책 (Container Image Control Policies)**
    - 인프라에서 실행할 수 있는 컨테이너를 지정할 수 있게 합니다. 이러한 컨테이너는 VM 또는 클러스터에서 실행할 수 있으며 정책은 VM 수준에서 적용됩니다.
        
    - **관찰 모드 (Observe Mode)**: 허용되지 않은 컨테이너가 VM에서 실행되면 사용자 활동이 이벤트를 생성합니다.
        
    - **강제 모드 (Enforce Mode)**: 사용자 활동이 이벤트를 생성하고 허용되지 않은 컨테이너는 종료되고 차단됩니다.
        
    - 지원 플랫폼: AWS, Microsoft Azure, Google Cloud Platform.
        
- **🛠️ 실습: ECR에 대한 컨테이너 취약점 스캔 정책 생성하기**
    - **목표**: Amazon ECR(Elastic Container Registry)에 저장된 컨테이너 이미지의 취약점을 스캔하는 정책을 만들고 실행합니다.
    - **사전 준비**: 스캔할 컨테이너 이미지가 업로드된 ECR 리포지토리가 있어야 합니다.
        
    - **정책 생성 단계**:
        1. Skyhigh CASB 대시보드 > 정책 (Policy) > 취약점 (Vulnerabilities) > 작업 (Actions) > 컨테이너 취약점 정책 만들기 (Create Container Vulnerability Policy)로 이동합니다.
        2. 이름(예: ECR-Vulnerability-Scan)을 할당하고 다음을 클릭합니다.
        3. 규칙(예: 특정 심각도 이상의 모든 CVE 탐지)을 만들고 다음을 클릭합니다.
        4. 심각도 및 대응을 할당하고 다음을 클릭합니다.
        5. 검토하고 저장합니다.
    - **스캔 구성 및 실행 단계**:
        1. 정책 (Policy) > 온디맨드 스캔 (On-Demand Scan)으로 이동합니다.
        2. 작업 (Actions) > 컨테이너 취약점 (Container Vulnerability)을 클릭합니다.
            
        3. 일반 정보 페이지에서 스캔 유형으로 '컨테이너 취약점'을 선택하고, 이름, 설명, 스캔할 서비스 인스턴스를 입력한 후 다음을 클릭합니다.
            
        4. 방금 만든 정책을 선택하고 다음을 클릭합니다.
        5. 스캔 구성 페이지에서 이미지 범위(전체 또는 증분), 스캔 날짜, 리포지토리(전체 또는 특정), 취약점 심각도 수준, 스캔할 계정을 구성하고 다음을 클릭합니다.
            
        6. 스캔 예약 페이지에서 일정(즉시 실행 권장)을 선택하고 다음을 클릭합니다.
            
        7. 검토 및 활성화 페이지에서 설정을 검토하고 저장한 후 스캔을 실행합니다.
            
        8. 정책 위반 페이지에서 스캔 완료 후 정책 위반 사항을 확인합니다.
            
- **CVE 정책의 차단 목록/허용 목록 (Block List/Allow List CVE Policies)**
    - 특정 CVE ID, 기능(feature), 네임스페이스(namespace), 심각도 등을 기준으로 취약점을 차단하거나 허용하는 정책을 만들어 인시던트의 우선순위를 정하거나 무시할 수 있습니다.
        
    - **차단 목록 정책 규칙 예시**: 특정 CVE, 'openssl' 기능, 'ubuntu:18.04' 네임스페이스에 대해 항상 높은 심각도의 인시던트를 생성하여 해당 항목이 무시되지 않도록 합니다.
        
    - **허용 목록 정책 규칙 예시**: 특정 CVE, 중간 또는 낮음 심각도 CVE, 'eglibc' 기능, 'debian:9' 네임스페이스와 일치하는 CVE에 대해서는 인시던트 심각도를 '낮음'으로 할당하고, 응답에서 '높음' 심각도에 대해서만 인시던트를 생성하도록 하여 특정 항목을 무시합니다.
        

---

#### **강의 7.4: 나노세그멘테이션 (Nano-Segmentation)**

- **컨테이너 세그멘테이션이란? 마이크로 vs. 나노**
    - 컨테이너 세그멘테이션은 컨테이너 간 통신을 분할하여 승인된 연결만 허용하는 방식입니다. 쿠버네티스와 같은 오케스트레이션 도구에 의해 서비스 개념에서 컨테이너가 생성되므로 서비스 수준에서 적용될 수 있습니다.
        
    - 컨테이너는 종종 마이크로서비스로 배포되므로 컨테이너 세그멘테이션은 마이크로세그멘테이션과 나노세그멘테이션으로 나눌 수 있습니다.
        
- **나노세그멘테이션의 역할**
    - 나노세그멘테이션은 데이터 센터 및 클라우드에서 실행되는 다계층 애플리케이션을 보호하여 위협 방지를 제공합니다. 조직이 애플리케이션을 가능한 가장 세분화된 수준으로 분할할 수 있게 합니다.
        
- **나노세그멘테이션의 중요성**
    - 마이크로세그멘테이션은 호스트 간 보안을 제공하지만 실행 중인 컨테이너 내의 취약점은 탐지되지 않을 수 있습니다. 단일 호스트에 여러 컨테이너가 있고 하나의 컨테이너가 손상되면 전체 호스트가 손상될 가능성이 있습니다.
        
    - 나노세그멘테이션은 컨테이너 또는 애플리케이션을 함께 연결하므로 컨테이너 또는 애플리케이션 수준에서 보안을 제공합니다. 마이크로세그멘테이션만으로는 컨테이너화된 마이크로서비스 인프라를 보호하기에 충분하지 않기 때문에 나노세그멘테이션이 중요합니다.
        
- **Skyhigh Security의 나노세그멘테이션 지원**
    - Skyhigh Security는 알려진 양호한 구성을 기반으로 컨테이너 간 통신을 검색하여 복잡하고 동적인 워크로드의 동작을 보호할 수 있도록 합니다.
        
    - 나노세그멘테이션 기능을 통해 다음을 수행할 수 있습니다:
        - 컨테이너의 일시적인 특성을 처리하고 IP 주소와 같은 외부 요인에 의존하지 않는 방식으로 컨테이너 프로세스 간 네트워크 통신 동작을 검색하고 모니터링합니다.
            
        - 비정상적인 통신을 탐지하고 사용자 기본 설정에 따라 알리거나 차단합니다.
            
        - 애플리케이션이 시간이 지남에 따라 발전함에 따라 컨테이너 버전 간의 통신 패턴 변화를 탐지합니다.
            
        - 알려진 악성 구성을 따라잡는 대신 알려진 양호한 구성을 활용하여 워크로드를 보호합니다.
            

---

### 🛠️ 모듈 7 실습 및 복습

- **CNAPP 개념 이해**:
    - CNAPP의 세 가지 주요 구성 요소(CSPM, CWPP, Apps/Data)가 각각 어떤 역할을 하는지 자신의 언어로 설명해보세요. Skyhigh Security Cloud가 이 중 어떤 부분에 초점을 맞추고 있는지 생각해보세요.
    - 우리 회사(또는 가상 회사)가 클라우드 네이티브 애플리케이션을 개발하고 있다면, CNAPP 도입으로 어떤 보안 이점을 얻을 수 있을지 구체적으로 나열해보세요.
- **컨테이너 보안 시나리오**:
    - 개발팀이 새로운 컨테이너 이미지를 ECR에 푸시했습니다. 이 이미지에 알려진 심각한 취약점이 포함되어 있는지 확인하고, 만약 있다면 프로덕션 배포를 막기 위해 어떤 조치를 취해야 할까요? Skyhigh Security Cloud의 컨테이너 보안 기능을 활용하여 설명해보세요. (힌트: CVS, 컨테이너 이미지 제어 정책)
- **나노세그멘테이션의 필요성**:
    - 마이크로서비스 아키텍처에서 마이크로세그멘테이션만으로는 부족하고 나노세그멘테이션이 필요한 이유를 구체적인 예를 들어 설명해보세요.
- **용어 정리**:
    - CNAPP (Cloud Native Application Protection Platform) - 클라우드 네이티브 애플리케이션 보호 플랫폼
    - CSPM (Cloud Security Posture Management) - 클라우드 보안 형상 관리
    - CWPP (Cloud Workload Protection Platform) - 클라우드 워크로드 보호 플랫폼 (Skyhigh는 더 이상 지원하지 않음)
    - IAM (Identity and Access Management) - ID 및 접근 관리
    - VM (Virtual Machine) - 가상 머신
    - DXL (Data Exchange Layer)
    - PoP (Point of Presence) - 접속 지점
    - CI/CD (Continuous Integration/Continuous Deployment) - 지속적 통합/지속적 배포
    - K8S (Kubernetes) - 쿠버네티스
    - ECR (Elastic Container Registry) - (AWS) 엘라스틱 컨테이너 레지스트리
    - IaC (Infrastructure as Code) - 코드형 인프라
    - CVE (Common Vulnerabilities and Exposures) - 공통 취약점 및 노출